////////////////////////////////////////////////////////////////////////////////////////////////////
// @brief AtLog File
////////////////////////////////////////////////////////////////////////////////////////////////////


#include "pch.h"
#include "AtLog.h"
#include "Logic/Utils/Time/AtTime.h"
#include "Logic/Utils/String/StringUtils.h"
#include <google/protobuf/util/json_util.h>


////////////////////////////////////////////////////////////////////////////////////////////////////
// @brief  msg를 출력한다.
////////////////////////////////////////////////////////////////////////////////////////////////////
AtVoid AtLog::PrintMsg(
	const char*                 file,
	      AtInt32               line,
	      AtString              msg,
	      AtStringColor::EColor color )
{
	AtStringColor stringColor( color );

	const char* fileName = extractFileName( file );
	std::cout << "[ " << AtTime::GetCurTimeFormat() << " ] " << fileName << "::" << line << ", " << msg << std::endl;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
// @brief  msg를 출력한다.
////////////////////////////////////////////////////////////////////////////////////////////////////
AtVoid AtLog::PrintNoFileMsg( AtString msg, AtStringColor::EColor color )
{
	std::cout << "[ " << AtTime::GetCurTimeFormat() << " ] "  << msg << std::endl;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
// @brief PacketData를 출력한다.
////////////////////////////////////////////////////////////////////////////////////////////////////
AtVoid AtLog::PrintPacketData( google::protobuf::Message& pkt )
{
	std::string jsonOutput;
	google::protobuf::util::MessageToJsonString( pkt, &jsonOutput );

	PrintNoFileMsg( "[RECV][ " + pkt.GetTypeName() + " ] "+  jsonOutput);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
// @brief  파일 경로에서 파일 이름만 추출하는 함수
////////////////////////////////////////////////////////////////////////////////////////////////////
const char* AtLog::extractFileName( const char* filePath )
{
	// '/' 기준으로 파일 이름 찾기 (유닉스 계열 OS)
	const char* fileName = std::strrchr( filePath, '/' ); 
	if ( !fileName )
	{
		// '\' 기준으로 파일 이름 찾기 (Windows)
		fileName = std::strrchr( filePath, '\\' );
	}

	// 경로 구분자가 있으면 그 다음 문자 반환, 없으면 전체 경로 반환
	return fileName ? fileName + 1 : filePath;
}
